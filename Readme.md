# Archive-Zipper Service

–í–µ–±-—Å–µ—Ä–≤–∏—Å –Ω–∞ Go –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –¥–æ —Ç—Ä—ë—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ URL, —É–ø–∞–∫–æ–≤–∫–∏ –∏—Ö –≤ ZIP-–∞—Ä—Ö–∏–≤ –∏ –≤—ã–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞:

```bash
git clone <repo-url>
cd <project>
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
go mod tidy
```

3.–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:

```bash
go run main.go --port=8080 --maxTasks=3 --shutdownDelay=3s
```

–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–æ–π:

```bash
make dev
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:

- –ø–æ—Ä—Ç: 8080
- –º–∞–∫—Å. –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á: 3
- —Ç–∞–π–º–∞—É—Ç graceful shutdown: 5s

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

1. –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
   POST /tasks

–£—Å–ø–µ—Ö:

```json
{
  "task_id": "<UUID>"
}
```

–û—à–∏–±–∫–∞:

```json
{
  "error": "server busy"
}
```

–ü—Ä–∏–º–µ—Ä curl –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X POST http://localhost:8080/tasks
```

2. –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª

```bash
POST /tasks/{id}/files
```

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

```json
{
  "url": "https://ru.wikipedia.org/wiki/SunOS#/media/%D0%A4%D0%B0%D0%B9%D0%BB:SunOS_4.1.1_P1270750.jpg"
}
```

–£—Å–ø–µ—Ö:

```json
{
  "message": "file added"
}
```

–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:

invalid request ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π JSON.

unsupported type ‚Äî —Ñ–∞–π–ª –Ω–µ .pdf/.jpeg/.jpg.

max files reached ‚Äî —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ 3 —Ñ–∞–π–ª–∞.

task not found ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π UUID.

–ü—Ä–∏–º–µ—Ä curl –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X POST http://localhost:8080/tasks/<UUID>/files \
  -H 'Content-Type: application/json' \
  -d '{"url":"https://example.com/file.jpg"}'
```

3. –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏

```bash
GET /tasks/{id}
```

–£—Å–ø–µ—Ö (–¥–æ 3 —Ñ–∞–π–ª–æ–≤):

```json
{
  "data": {
    "id": "<UUID>",
    "status": "in_progress",
    "files": [
      { "url": "...", "success": true },
      { "url": "...", "success": false, "error": "timeout" }
    ]
  }
}
```

–£—Å–ø–µ—Ö (–ø–æ—Å–ª–µ 3—Ö —Ñ–∞–π–ª–æ–≤):

```json
{
  "data": {
    "id": "<UUID>",
    "status": "done",
    "files": [
      /* —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */
    ],
    "archive_url": "http://localhost:8080/tasks/<UUID>/archive"
  }
}
```

–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞—Ä—Ö–∏–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ –ø–æ–ª–µ archive_url

–ü—Ä–∏–º–µ—Ä curl –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl http://localhost:8080/tasks/<UUID>
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ñ–ª–∞–≥–∏

--port ‚Äî –ø–æ—Ä—Ç –¥–ª—è HTTP (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8080)

--maxTasks ‚Äî –º–∞–∫—Å. –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)

--shutdownDelay ‚Äî —Ç–∞–π–º–∞—É—Ç graceful shutdown (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5s)

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

Dependency Injection
‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ TaskManager –≤ HTTP-handlers —á–µ—Ä–µ–∑ handlers.Init().

Graceful Shutdown
‚Äî –ª–æ–≤–ª—è SIGINT/SIGTERM, –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á.

–ü—É–ª –∑–∞–¥–∞—á
‚Äî –Ω–µ –±–æ–ª–µ–µ N –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á (maxTasks).

–ú—å—é—Ç–µ–∫—Å—ã –∏ Snapshot-–º–æ–¥–µ–ª—å
‚Äî sync.Mutex –¥–ª—è TaskManager –∏ Task; GetSnapshot() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ø–∏—é –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚Äî –∞—Ä—Ö–∏–≤–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ –ø–æ—Å–ª–µ 3-–≥–æ —Ñ–∞–π–ª–∞.

–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è .pdf, .jpeg, .jpg; –¥–æ 3 —Ñ–∞–π–ª–æ–≤ –Ω–∞ –∑–∞–¥–∞—á—É.

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π ZIP
‚Äî —Å–±–æ—Ä–∫–∞ –∞—Ä—Ö–∏–≤–∞ —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç archive/zip.

Temporary files
‚Äî —Å–∫–∞—á–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É, –≥–æ—Ç–æ–≤—ã–µ ZIP –≤ ./archives.

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ logrus

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

~/
main.go # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, DI, —Ñ–ª–∞–≥–∏, graceful shutdown
handlers/ # HTTP-handlers, JSON-—É—Ç–∏–ª–∏—Ç—ã
task/ # –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, TaskManager, Task, –∞—Ä—Ö–∏–≤–∞—Ü–∏—è
archives/ # –≥–æ—Ç–æ–≤—ã–µ ZIP-–∞—Ä—Ö–∏–≤—ã
